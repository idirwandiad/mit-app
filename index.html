<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Visit Team App</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">


<style>
body { background:#f4f6f9; }

.hero {
  background: linear-gradient(135deg,#00c853,#1de9b6);
  color:white;
  padding:50px 20px 70px;
  border-bottom-left-radius:35px;
  border-bottom-right-radius:35px;
  box-shadow:0 4px 15px rgba(0,0,0,.2);
}

.card {
  border-radius:18px;
  border:none;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
}

.card:active {
  transform: scale(0.98);
}

video, canvas {
  width:100%;
  border-radius:15px;
}

/* warna berdasarkan class */
.gold { background:#fff8e1; border-left:6px solid gold; }
.silver { background:#f5f5f5; border-left:6px solid silver; }
.bronze { background:#fbe9e7; border-left:6px solid #cd7f32; }
.yellow { background:#fffde7; border-left:6px solid #fbc02d; }
.platinum { background:#e3f2fd; border-left:6px solid #90caf9; }

/* icon kulkas */
.gdm-icon {
  font-size: 22px;
  color: red;
  margin-right: 2px;
}

/* thumbnail */
.thumb {
  width:90px;
  height:90px;
  object-fit:cover;
  border-radius:14px;
  border:none;
  box-shadow:0 2px 8px rgba(0,0,0,.2);
}
.thumb-empty {
  width:100px;
  height:100px;
  border-radius:12px;
  border:2px dashed #ccc;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
  color:#999;
}

/* modal preview foto harus paling atas */
#photoModal {
  z-index: 99999 !important;
}

#photoModal .modal-backdrop {
  z-index: 99998 !important;
}

.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  box-shadow:0 -3px 10px rgba(0,0,0,.15);
  border-top-left-radius:20px;
  border-top-right-radius:20px;
  z-index:9999;
}

.action-btn-wrap {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 11px;
  color: #888; /* mute */
}

.action-btn {
  width: 42px;
  height: 42px;
  border-radius: 50% !important;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  margin-bottom: 2px;
}

.camera-wrap {
  position: relative;
}

.capture-btn {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: #00c853;
  border: 5px solid white;
  box-shadow: 0 4px 15px rgba(0,0,0,.4);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: white;
  z-index: 1000;
}

.capture-btn:active {
  transform: translateX(-50%) scale(0.95);
}

.switch-btn {
  position: absolute;
  bottom: 30px;
  right: 20px;
  width: 45px;
  height: 45px;
  border-radius: 50%;
  background: rgba(0,0,0,0.6);
  border: none;
  color: white;
  font-size: 20px;
  z-index: 1001;
}
.switch-btn:active {
  transform: scale(0.9);
}

.team-chip {
  padding: 8px 14px;
  border-radius: 20px;
  background: #e9ecef;
  font-size: 13px;
  white-space: nowrap;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: .2s;
}

.team-chip.active {
  background: linear-gradient(135deg,#00c853,#1de9b6);
  color: white;
  font-weight: 600;
  box-shadow: 0 3px 10px rgba(0,0,0,.2);
}

</style>
</head>
<body>

<!-- HERO -->
<div class="hero text-center">
  <h3>üè™ APLIKASI 2026</h3>
  <p class="mb-1">Medan</p>
</div>


<!-- LIST PAGE -->
<div id="listPage" class="container mt-3">
  <div id="teamSelector" class="d-flex gap-2 overflow-auto mb-3"></div>

  <div id="shopList"></div>
</div>

<!-- CAMERA PAGE -->
<div id="cameraPage" class="container mt-3" style="display:none;">
  <h5>üì∏ Selfie Check-in</h5>

  <div class="camera-wrap">
    <video id="video" autoplay playsinline muted></video>
    <canvas id="canvas" class="mt-2"></canvas>

    <!-- SWITCH CAMERA -->
    <button class="switch-btn" onclick="switchCamera()">
      <i class="bi bi-arrow-repeat"></i>
    </button>

    <!-- CAPTURE -->
    <button class="capture-btn" onclick="capturePhoto()">
      <i class="bi bi-camera-fill"></i>
    </button>
  </div>
</div>

<!-- MODAL DETAIL TOKO -->
<div class="modal fade" id="shopModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header">
        <h5 class="modal-title">Detail Toko</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>
</div>

<!-- MODAL FOTO -->
<div class="modal fade" id="photoModal">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Foto Check-in</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <img id="fullPhoto" src="" class="img-fluid rounded">
      </div>
    </div>
  </div>
</div>

<!-- MODAL AKTIVITAS -->
<div class="modal fade" id="activityModal">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content rounded-4">
      <div class="modal-header">
        <h5 class="modal-title">Aktivitas Outlet</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="activityBody"></div>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer class="text-center py-3 mt-4" style="color:#888; font-size:13px;">
  ¬© 2026 MEDAN
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


<script>
// ================= DATA TOKO (CONTOH) =================
const shops = [
 {team:"Anak Medan",leader:"EKO RISDIANTO",name:"TOKO XXXX",address:"JL MEDAN",subtrade:"N15",gdm:"XX00000",class:"Gold",lat:3.681299,lng:98.663244},
{team:"Anak Medan",leader:"EKO RISDIANTO",name:"TOKO YYYY",address:"JL MEDAN",subtrade:"N23",gdm:"YY00000",class:"Silver",lat:3.6675917,lng:98.6463018}

];


let currentShop=null;
const teamSelect=document.getElementById("teamSelect");
const video=document.getElementById("video");
const canvas=document.getElementById("canvas");

let currentFacingMode = "user"; // user = depan, environment = belakang


// ================= LOCAL STORAGE =================
function saveCheckin(shopName, imageData){
  let checkins = JSON.parse(localStorage.getItem("checkins")) || {};
  checkins[shopName] = imageData;
  localStorage.setItem("checkins", JSON.stringify(checkins));
}
function getCheckin(shopName){
  let checkins = JSON.parse(localStorage.getItem("checkins")) || {};
  return checkins[shopName] || null;
}

// ================= TEAM LIST =================
const teamSelector = document.getElementById("teamSelector");
let selectedTeam = null;

function getTeamIcon(team){
  if(team.includes("Medan")) return "üèôÔ∏è";
  if(team.includes("Sprite")) return "ü•§";
  return "üè™";
}

[...new Set(shops.map(s=>s.team))].forEach((t,i)=>{
  const div = document.createElement("div");
  div.className = "team-chip" + (i===0 ? " active":"");
  div.innerHTML = `<span>${getTeamIcon(t)}</span> ${t}`;

  div.onclick = ()=>{
    document.querySelectorAll(".team-chip").forEach(x=>x.classList.remove("active"));
    div.classList.add("active");
    selectedTeam = t;
    renderList();
  };

  teamSelector.appendChild(div);

  if(i===0) selectedTeam = t;
});

// ================= STYLE CLASS =================
function classStyle(cls){
  return cls.toLowerCase();
}

// ================= ICON GDM =================
function renderGDM(code){
  return `<span class="gdm-icon">üßä</span> <b>${code}</b>`;
}

function capturePhoto(){
  if(currentActivity){
    captureActivity();
  }else{
    captureCheckin();
  }
}


// ================= RENDER LIST =================
function renderList(){
  const list = document.getElementById("shopList");
  list.innerHTML = "";

  shops
    .filter(s => s.team === selectedTeam)

    .forEach(s => {
      const thumb = getCheckin(s.name);

      list.innerHTML += `
      <div class="card mb-3 ${classStyle(s.class)}">
        <div class="card-body position-relative">

          <!-- Badge Class -->
          <span class="badge bg-dark position-absolute top-0 end-0 m-2">
            ${s.class}
          </span>

          <div class="d-flex">
            <!-- Info -->
            <div style="flex:1">
              <b><i class="bi bi-shop text-primary"></i> ${s.name}</b><br>
              <small class="text-muted">
                <i class="bi bi-geo-alt"></i> ${s.address}
              </small><br>

              <div class="mt-1">
                <span class="badge bg-info">${s.subtrade}</span>
                <span class="badge bg-secondary">${renderGDM(s.gdm)}</span>
              </div>

              <div class="mt-1">
                <small>Leader: ${s.leader}</small>
              </div>
            </div>

            <!-- Thumbnail -->
            <div class="ms-2">
              ${
                thumb
                  ? `<img src="${thumb}" class="thumb" onclick="openPhoto('${s.name}')">`
                  : `<div class="thumb-empty">No Photo</div>`
              }
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="d-flex justify-content-around mt-3">

  <div class="action-btn-wrap">
    <button class="btn btn-primary action-btn"
            onclick="openModal('${s.name}')">
      <i class="bi bi-info-circle"></i>
    </button>
    <span>Detail</span>
  </div>

  <div class="action-btn-wrap">
    <button class="btn btn-warning action-btn"
            onclick="openMap(${s.lat},${s.lng})">
      <i class="bi bi-geo-alt"></i>
    </button>
    <span>Map</span>
  </div>

  <div class="action-btn-wrap">
    <button class="btn btn-success action-btn"
            onclick="startCamera('${s.name}')">
      <i class="bi bi-camera"></i>
    </button>
    <span>Foto</span>
  </div>

  <div class="action-btn-wrap">
    <button class="btn btn-info action-btn"
            onclick="openActivity('${s.name}')">
      <i class="bi bi-journal-text"></i>
    </button>
    <span>Aktivitas</span>
  </div>

</div>


        </div>
      </div>`;
    });
}
renderList();

// ================= MODAL DETAIL =================
function openModal(name){
  const s = shops.find(x=>x.name===name);
  document.getElementById("modalBody").innerHTML = `
    <h5 class="mb-2">
      <i class="bi bi-shop text-primary"></i> ${s.name}
    </h5>
    <div class="text-muted mb-2">
      <i class="bi bi-geo-alt"></i> ${s.address}
    </div>
    <hr>
    <div><b>Channel:</b> ${s.subtrade}</div>
    <div><b>GDM:</b> ${s.gdm}</div>
    <div><b>Class:</b> ${s.class}</div>
    <div><b>Team:</b> ${s.team}</div>
    <div><b>Leader:</b> ${s.leader}</div>
  `;
  new bootstrap.Modal(document.getElementById("shopModal")).show();
}

// ================= PREVIEW FOTO =================
function openPhoto(shopName){
  const img = getCheckin(shopName);
  if(!img){
    alert("Belum ada foto");
    return;
  }
  document.getElementById("fullPhoto").src = img;
  new bootstrap.Modal(document.getElementById("photoModal")).show();
}

// ================= MAP =================
function openMap(lat,lng){
  window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`);
}

// ================= CAMERA =================
async function startCamera(name){
  currentShop = shops.find(x=>x.name===name);
  showPage("cameraPage");
  await openCamera();
}

async function openCamera(){
  stopCamera(); // matikan kamera lama kalau ada

  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: currentFacingMode },
      audio: false
    });
    video.srcObject = stream;
    await video.play();
  } catch (err) {
    alert("Tidak bisa membuka kamera");
    console.error(err);
  }
}

async function switchCamera(){
  if(currentFacingMode === "user"){
    currentFacingMode = "environment";
  } else {
    currentFacingMode = "user";
  }

  await openCamera();
}

// ================= CAPTURE =================
function captureCheckin(){
  if(!video.srcObject){
    alert("Kamera belum aktif");
    return;
  }

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight + 180;
  const ctx = canvas.getContext("2d");

  ctx.drawImage(video,0,0);

  ctx.fillStyle="black";
  ctx.fillRect(0,video.videoHeight,canvas.width,180);

  ctx.fillStyle="white";
  ctx.font="16px Arial";
  let y = video.videoHeight + 25;

  ctx.fillText("Toko   : " + currentShop.name,10,y); y+=22;
  ctx.fillText("Alamat : " + currentShop.address,10,y); y+=22;
  ctx.fillText("Team   : " + currentShop.team,10,y); y+=22;
  ctx.fillText("Leader : " + currentShop.leader,10,y); y+=22;
  ctx.fillText("Channel: " + currentShop.subtrade,10,y); y+=22;
  ctx.fillText("GDM    : " + currentShop.gdm,10,y); y+=22;
  ctx.fillText("Class  : " + currentShop.class,10,y);

const imageData = canvas.toDataURL("image/jpeg");

saveCheckin(currentShop.name, imageData); // untuk thumbnail & preview
autoDownload(imageData);                  // untuk masuk galeri

stopCamera();
alert("Check-in berhasil!");
showPage("listPage");
renderList();

}

// ================= PAGE SWITCH =================
function showPage(id){
  document.getElementById("listPage").style.display="none";
  document.getElementById("cameraPage").style.display="none";
  document.getElementById(id).style.display="block";
}

const activities = [
 "Siapa Pelanggan Kita",
 "CLEAN & MERCHANDISE OUR ASSETS",
 "Pasang POSM sesuai panduan PICOS",
 "Form Penjualan",
 "GDM Arrangement Before After",
 "Setup Floor Display",
 "Pengisian Mark Apps & Google Form"
];

function saveActivity(shop, act, img){
  let data = JSON.parse(localStorage.getItem("activities")) || {};
  if(!data[shop]) data[shop]={};
  data[shop][act]=img;
  localStorage.setItem("activities", JSON.stringify(data));
}

function getActivity(shop, act){
  let data = JSON.parse(localStorage.getItem("activities")) || {};
  return data[shop]?.[act] || null;
}

function openActivity(shopName){
  currentShop = shops.find(x=>x.name===shopName);
  let html = `<h6><i class="bi bi-shop"></i> ${shopName}</h6><hr>`;

  activities.forEach(act=>{

    // ===== KHUSUS GDM (BEFORE & AFTER) =====
    if(act === "GDM Arrangement Before After"){
      const beforeImg = getActivity(shopName, act+"_before");
      const afterImg  = getActivity(shopName, act+"_after");

      html += `
      <div class="card mb-2">
        <div class="card-body">
          <b>${act}</b>

          <div class="d-flex gap-3 mt-2 justify-content-center">

            <div class="text-center">
              ${
                beforeImg
                  ? `<img src="${beforeImg}" class="thumb" onclick="previewActivity('${shopName}','${act}_before')">`
                  : `<div class="thumb-empty">Before</div>`
              }
              <button class="btn btn-sm btn-warning mt-1"
                onclick="startActivityCamera('${shopName}','${act}_before')">
                üì∏ Before
              </button>
            </div>

            <div class="text-center">
              ${
                afterImg
                  ? `<img src="${afterImg}" class="thumb" onclick="previewActivity('${shopName}','${act}_after')">`
                  : `<div class="thumb-empty">After</div>`
              }
              <button class="btn btn-sm btn-success mt-1"
                onclick="startActivityCamera('${shopName}','${act}_after')">
                üì∏ After
              </button>
            </div>

          </div>
        </div>
      </div>`;
    }

    // ===== AKTIVITAS BIASA (1 FOTO) =====
    else {
      const img = getActivity(shopName, act);

      html += `
      <div class="card mb-2">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <b>${act}</b><br>
            ${
              img
                ? `<small class="text-success">‚úî Sudah ada foto</small>`
                : `<small class="text-danger">‚úò Belum ada foto</small>`
            }
          </div>

          <div class="d-flex align-items-center gap-2">
            ${
              img
                ? `<img src="${img}" class="thumb" onclick="previewActivity('${shopName}','${act}')">`
                : `<div class="thumb-empty">No Photo</div>`
            }
            <button class="btn btn-sm btn-success"
              onclick="startActivityCamera('${shopName}','${act}')">üì∏</button>
          </div>
        </div>
      </div>`;
    }

  });

  document.getElementById("activityBody").innerHTML = html;
  new bootstrap.Modal(document.getElementById("activityModal")).show();
}

let currentActivity = null;

async function startActivityCamera(shop, act){
  currentShop = shops.find(x=>x.name===shop);
  currentActivity = act;

  // tutup modal aktivitas dulu
  bootstrap.Modal.getInstance(document.getElementById("activityModal")).hide();

  showPage("cameraPage");

  setTimeout(async ()=>{
    const stream = await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject = stream;
    video.play();
  },300);
}

function captureActivity(){
  if(!video.srcObject) return alert("Kamera belum aktif");

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight + 200;
  const ctx = canvas.getContext("2d");

  ctx.drawImage(video,0,0);

  ctx.fillStyle="black";
  ctx.fillRect(0,video.videoHeight,canvas.width,200);

  ctx.fillStyle="white";
  ctx.font="16px Arial";
  let y = video.videoHeight + 25;

  ctx.fillText("Toko: " + currentShop.name,10,y); y+=22;
  ctx.fillText("Aktivitas: " + currentActivity,10,y);

const img = canvas.toDataURL("image/jpeg");

saveActivity(currentShop.name, currentActivity, img);
autoDownload(img);

  stopCamera();
  currentActivity=null;

  showPage("listPage");

  setTimeout(()=>{
    openActivity(currentShop.name);
  },300);

  alert("Foto aktivitas tersimpan");
}

function stopCamera(){
  if(video.srcObject){
    video.srcObject.getTracks().forEach(t=>t.stop());
    video.srcObject=null;
  }
}

function autoDownload(base64) {
  fetch(base64)
    .then(res => res.blob())
    .then(blob => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "MIT_" + Date.now() + ".jpg";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
}


function previewActivity(shop, act){
  const img = getActivity(shop, act);
  document.getElementById("fullPhoto").src = img;
  new bootstrap.Modal(document.getElementById("photoModal")).show();
}

</script>

</body>
</html>


